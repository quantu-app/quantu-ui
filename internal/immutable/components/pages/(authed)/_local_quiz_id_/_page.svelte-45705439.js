import{S as W,i as Y,F as J,a2 as he,a3 as me,k as z,q as A,a as E,w as C,l as g,m as w,r as D,h,c as B,x as L,n as q,b as $,K as m,y as U,U as T,a4 as Qe,f as j,t as N,z as P,a5 as te,a6 as be,a7 as ze,D as re,B as ge,V as qe,E as we,u as se,a8 as ye,L as ae}from"../../../../chunks/index-5ae55930.js";import{d as ue,w as Ie}from"../../../../chunks/index-9253242f.js";import{o as ve,w as ce,a as de,q as S,g as $e}from"../../../../chunks/user-ed7e6b8d.js";import{g as H,b as fe,d as ke,i as Ee,M as Be,a as Ae,S as ie}from"../../../../chunks/SortDirection-ba1a904e.js";import{g as De}from"../../../../chunks/navigation-7c3aff51.js";import{c as Te}from"../../../../chunks/shared-23917130.js";import{p as Oe}from"../../../../chunks/stores-cb3df0b3.js";async function Se(s){return await(await H()).getAllFromIndex("questions","user_id",s)}async function _e(s,t,e,o){const i=await H(),n={...X(s,t,e),...o,uri:o.name?fe(o.name):void 0},u=await i.put("questions",n);return{...n,local_id:u}}async function Ce(s,t,e,o,i){const n=await H(),u=await n.get("questions",o)||X(s,t,e),c={...u,...i,user_id:s,local_quiz_id:t,quiz_id:e,local_id:o,uri:i.name?fe(i.name):u.uri,updated_at:new Date};return await n.put("questions",c,o),c}async function Le(s,t,e,o,i){const n=await H(),c={...await n.get("questions",o)||X(s,t,e),...i,user_id:s,local_quiz_id:t,quiz_id:e,local_id:o};return await n.put("questions",c),c}async function oe(s){await(await H()).delete("questions",s)}function X(s,t,e){return{id:0,local_quiz_id:t,local_deleted:0,quiz_id:e,user_id:s,name:"",uri:"",created_at:new Date,updated_at:new Date}}const F=Ie({});ue(F,s=>Object.values(s));const Ue=ue(F,s=>Object.values(s).reduce((t,e)=>((t[e.local_quiz_id]||(t[e.local_quiz_id]=[])).push(e),t),{}));async function je(s,t){var o;const e=await Ee(s);if(e){const i=(o=$e())==null?void 0:o.id;let n={};de()&&(n=await S.postApiQuizzesQuizIdQuestions({quizId:e.id,postApiQuizzesQuizIdQuestions:t}));const u=await _e(i,e.local_id,e.id,{...t,...n});return F.update(c=>({...c,[u.local_id]:u})),u}}async function pe(s){const t=await ke(),e=Object.values(t).reduce((c,l)=>(c[l.id]=l,c),{}),o=await Se(s),i={},n={},u=[];for(const c of o)c.id===0?u.push(c):n[c.id]=c,c.local_deleted===0&&(i[c.local_id]=c);if(F.update(c=>({...c,...i})),de()){const c=(await Promise.all(Object.keys(e).map(a=>S.getApiQuizzesQuizIdQuestions({quizId:parseInt(a)})))).flat(1),l={},Q=new Set,f=[];for(const a of c){const r=n[a.id];if(r)r.updated_at>a.updated_at?r.local_deleted===1?f.push(S.deleteApiQuizzesQuizIdQuestionsId({quizId:a.quiz_id,id:a.id}).then(()=>oe(r.local_id)).then(()=>{Q.add(r.local_id)})):f.push(S.patchApiQuizzesQuizIdQuestionsId({quizId:a.quiz_id,id:a.id,patchApiQuizzesQuizIdQuestionsId:{...a,...r}}).then(_=>{l[r.id]={...r,..._}})):r.updated_at<a.updated_at?f.push(Ce(s,r.local_quiz_id,a.quiz_id,r.local_id,{...r,...a}).then(_=>{l[_.local_id]=_})):l[r.local_id]={...r,...a};else{const _=e[a.quiz_id];f.push(_e(s,_.local_id,_.id,a).then(b=>{l[b.local_id]=b}))}}for(const a of u)f.push(S.postApiQuizzesQuizIdQuestions({quizId:a.quiz_id,postApiQuizzesQuizIdQuestions:a}).then(r=>Le(s,a.local_quiz_id,a.quiz_id,a.local_id,r)).then(r=>{l[r.local_id]=r}));await Promise.all(f),await Promise.all(Object.values(n).map(async a=>{l[a.local_id]||(Q.add(a.local_id),await oe(a.local_id))})),F.update(a=>{a={...a,...l};for(const r of Q)delete a[r];return a})}}ve.on("online",async()=>{const s=await ce();pe(s.id)});ce().then(s=>pe(s.id));function Ne(s){let t,e,o,i,n,u,c,l,Q;return{c(){t=z("form"),e=z("input"),o=E(),i=z("div"),n=z("div"),u=z("input"),this.h()},l(f){t=g(f,"FORM",{});var a=w(t);e=g(a,"INPUT",{type:!0,class:!0,placeholder:!0}),o=B(a),i=g(a,"DIV",{class:!0});var r=w(i);n=g(r,"DIV",{class:!0});var _=w(n);u=g(_,"INPUT",{type:!0,class:!0}),_.forEach(h),r.forEach(h),a.forEach(h),this.h()},h(){q(e,"type","text"),q(e,"class","mb-1"),q(e,"placeholder","Name"),q(u,"type","submit"),q(u,"class","btn primary"),u.value="Create Question",u.disabled=c=!s[0],q(n,"class","flex"),q(i,"class","flex flex-column justify-end")},m(f,a){$(f,t,a),m(t,e),te(e,s[0]),m(t,o),m(t,i),m(i,n),m(n,u),l||(Q=[be(Ae.call(null,e)),T(e,"input",s[5]),T(t,"submit",ze(s[2]))],l=!0)},p(f,a){a&1&&e.value!==f[0]&&te(e,f[0]),a&1&&c!==(c=!f[0])&&(u.disabled=c)},d(f){f&&h(t),l=!1,re(Q)}}}function Pe(s){let t,e;return{c(){t=z("h3"),e=A("Create a Question"),this.h()},l(o){t=g(o,"H3",{slot:!0});var i=w(t);e=D(i,"Create a Question"),i.forEach(h),this.h()},h(){q(t,"slot","title")},m(o,i){$(o,t,i),m(t,e)},p:ge,d(o){o&&h(t)}}}function Fe(s){let t,e,o,i,n,u,c,l;function Q(a){s[6](a)}let f={$$slots:{title:[Pe],default:[Ne]},$$scope:{ctx:s}};return s[1]!==void 0&&(f.open=s[1]),i=new Be({props:f}),he.push(()=>me(i,"open",Q)),{c(){t=z("button"),e=A("Create Question"),o=E(),C(i.$$.fragment),this.h()},l(a){t=g(a,"BUTTON",{class:!0});var r=w(t);e=D(r,"Create Question"),r.forEach(h),o=B(a),L(i.$$.fragment,a),this.h()},h(){q(t,"class","btn primary")},m(a,r){$(a,t,r),m(t,e),$(a,o,r),U(i,a,r),u=!0,c||(l=T(t,"click",s[3]),c=!0)},p(a,[r]){const _={};r&513&&(_.$$scope={dirty:r,ctx:a}),!n&&r&2&&(n=!0,_.open=a[1],Qe(()=>n=!1)),i.$set(_)},i(a){u||(j(i.$$.fragment,a),u=!0)},o(a){N(i.$$.fragment,a),u=!1},d(a){a&&h(t),a&&h(o),P(i,a),c=!1,l()}}}function He(s,t,e){let{localQuizId:o}=t,i,n="flash_card",u={};async function c(){await je(o,{name:i,question_type:n,data:u}),e(0,i=""),n="flash_card",u={},e(1,l=!1)}let l=!1;function Q(){e(1,l=!0)}function f(){i=this.value,e(0,i)}function a(r){l=r,e(1,l)}return s.$$set=r=>{"localQuizId"in r&&e(4,o=r.localQuizId)},[i,l,c,Q,o,f,a]}class Me extends W{constructor(t){super(),Y(this,t,He,Fe,J,{localQuizId:4})}}function ne(s,t,e){const o=s.slice();return o[5]=t[e],o}function le(s,t){let e,o,i=t[5].name+"",n,u,c,l=t[5].created_at.toLocaleString()+"",Q,f,a,r;return{key:s,first:null,c(){e=z("tr"),o=z("td"),n=A(i),u=E(),c=z("td"),Q=A(l),f=E(),this.h()},l(_){e=g(_,"TR",{class:!0});var b=w(e);o=g(b,"TD",{class:!0});var y=w(o);n=D(y,i),y.forEach(h),u=B(b),c=g(b,"TD",{class:!0});var O=w(c);Q=D(O,l),O.forEach(h),f=B(b),b.forEach(h),this.h()},h(){q(o,"class","border-b border-slate-100 dark:border-slate-700 p-1"),q(c,"class","border-b border-slate-100 dark:border-slate-700 p-1"),q(e,"class","hover:bg-gray-200 cursor-pointer"),this.first=e},m(_,b){$(_,e,b),m(e,o),m(o,n),m(e,u),m(e,c),m(c,Q),m(e,f),a||(r=T(e,"click",function(){we(t[4](t[5]))&&t[4](t[5]).apply(this,arguments)}),a=!0)},p(_,b){t=_,b&1&&i!==(i=t[5].name+"")&&se(n,i),b&1&&l!==(l=t[5].created_at.toLocaleString()+"")&&se(Q,l)},d(_){_&&h(e),a=!1,r()}}}function Re(s){let t,e,o,i,n,u,c,l,Q,f,a,r,_,b,y=[],O=new Map,M,V,Z;t=new Me({props:{localQuizId:s[1]}}),l=new ie({props:{sort:s[2]&&s[2][0]==="name",asc:s[2]&&s[2][1]===1}}),r=new ie({props:{sort:s[2]&&s[2][0]==="created_at",asc:s[2]&&s[2][1]===1}});let R=s[0];const x=d=>d[5].local_id;for(let d=0;d<R.length;d+=1){let p=ne(s,R,d),I=x(p);O.set(I,y[d]=le(I,p))}return{c(){C(t.$$.fragment),e=E(),o=z("table"),i=z("thead"),n=z("tr"),u=z("th"),c=A("Name "),C(l.$$.fragment),Q=E(),f=z("th"),a=A("Created At "),C(r.$$.fragment),_=E(),b=z("tbody");for(let d=0;d<y.length;d+=1)y[d].c();this.h()},l(d){L(t.$$.fragment,d),e=B(d),o=g(d,"TABLE",{class:!0});var p=w(o);i=g(p,"THEAD",{});var I=w(i);n=g(I,"TR",{});var v=w(n);u=g(v,"TH",{class:!0});var k=w(u);c=D(k,"Name "),L(l.$$.fragment,k),k.forEach(h),Q=B(v),f=g(v,"TH",{class:!0});var G=w(f);a=D(G,"Created At "),L(r.$$.fragment,G),G.forEach(h),v.forEach(h),I.forEach(h),_=B(p),b=g(p,"TBODY",{});var ee=w(b);for(let K=0;K<y.length;K+=1)y[K].l(ee);ee.forEach(h),p.forEach(h),this.h()},h(){q(u,"class","border-b dark:border-slate-600 cursor-pointer select-none text-left p-1"),q(f,"class","border-b dark:border-slate-600 cursor-pointer select-none text-left p-1"),q(o,"class","table-auto w-full")},m(d,p){U(t,d,p),$(d,e,p),$(d,o,p),m(o,i),m(i,n),m(n,u),m(u,c),U(l,u,null),m(n,Q),m(n,f),m(f,a),U(r,f,null),m(o,_),m(o,b);for(let I=0;I<y.length;I+=1)y[I].m(b,null);M=!0,V||(Z=[T(u,"click",s[3]("name")),T(f,"click",s[3]("created_at"))],V=!0)},p(d,[p]){const I={};p&2&&(I.localQuizId=d[1]),t.$set(I);const v={};p&4&&(v.sort=d[2]&&d[2][0]==="name"),p&4&&(v.asc=d[2]&&d[2][1]===1),l.$set(v);const k={};p&4&&(k.sort=d[2]&&d[2][0]==="created_at"),p&4&&(k.asc=d[2]&&d[2][1]===1),r.$set(k),p&17&&(R=d[0],y=qe(y,p,x,1,d,R,O,b,ye,le,null,ne))},i(d){M||(j(t.$$.fragment,d),j(l.$$.fragment,d),j(r.$$.fragment,d),M=!0)},o(d){N(t.$$.fragment,d),N(l.$$.fragment,d),N(r.$$.fragment,d),M=!1},d(d){P(t,d),d&&h(e),d&&h(o),P(l),P(r);for(let p=0;p<y.length;p+=1)y[p].d();V=!1,re(Z)}}}function Ve(s,t,e){let{localQuizId:o}=t,{questions:i}=t,n;function u(l){function Q(f,a){return n&&n[1]===-1?f[l]<a[l]?-1:1:f[l]>a[l]?-1:1}return()=>{n&&n[0]===l?e(2,n=[l,-n[1]]):e(2,n=[l,1]),e(0,i=[...i].sort(Q))}}function c(l){return async()=>{await De(`${Te}/${l.local_id}`)}}return s.$$set=l=>{"localQuizId"in l&&e(1,o=l.localQuizId),"questions"in l&&e(0,i=l.questions)},[i,o,n,u,c]}class Ge extends W{constructor(t){super(),Y(this,t,Ve,Re,J,{localQuizId:1,questions:0})}}function Ke(s){let t,e,o;return e=new Ge({props:{localQuizId:s[0],questions:s[1]}}),{c(){t=z("div"),C(e.$$.fragment),this.h()},l(i){t=g(i,"DIV",{class:!0});var n=w(t);L(e.$$.fragment,n),n.forEach(h),this.h()},h(){q(t,"class","container mx-auto")},m(i,n){$(i,t,n),U(e,t,null),o=!0},p(i,[n]){const u={};n&1&&(u.localQuizId=i[0]),n&2&&(u.questions=i[1]),e.$set(u)},i(i){o||(j(e.$$.fragment,i),o=!0)},o(i){N(e.$$.fragment,i),o=!1},d(i){i&&h(t),P(e)}}}function We(s,t,e){let o,i,n,u;return ae(s,Ue,c=>e(2,n=c)),ae(s,Oe,c=>e(3,u=c)),s.$$.update=()=>{s.$$.dirty&8&&e(0,o=parseInt(u.params.local_quiz_id)),s.$$.dirty&5&&e(1,i=n[o]||[])},[o,i,n,u]}class st extends W{constructor(t){super(),Y(this,t,We,Ke,J,{})}}export{st as default};
